<!doctype html>
<html lang="sq">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>ARKA â€¢ Transport â€¢ Shpenzime â€¢ Dita</title>
<style>
:root{
  --bg:#0b1220; --bg2:#0a111c;
  --panel:#0f1a2a; --panel2:#101a27;
  --line:#1f2e46; --text:#eaf1ff; --muted:#9fb4d6;
  --blue1:#1aa5d8; --blue2:#146b95;
  --green1:#19a25f; --green2:#0e6d3d;
  --amber1:#c78a2a; --amber2:#8a5f19;
  --red1:#ff5a5a; --red2:#8b2a2a;
}
*{box-sizing:border-box}
body{margin:0;background:linear-gradient(180deg,var(--bg),var(--bg2));color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;letter-spacing:.2px}
a{color:inherit;text-decoration:none}
.app{max-width:980px;margin:0 auto;padding:16px}
.panel{background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));border:1px solid var(--line);border-radius:14px;padding:14px;box-shadow:0 0 0 1px rgba(255,255,255,.04) inset}
.header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
.brand{display:flex;align-items:center;gap:10px}
.logo{width:40px;height:40px;border-radius:10px;background:linear-gradient(180deg,#254369,#15263c);border:1px solid #203651;display:flex;align-items:center;justify-content:center}
.brand h1{margin:0;font-size:18px;letter-spacing:.6px}
.badge{background:linear-gradient(180deg,var(--blue1),var(--blue2));border:1px solid #1f6f97;color:#eaffff;padding:6px 10px;border-radius:999px;font-weight:1000}

h2{margin:10px 0 6px;font-size:16px;letter-spacing:.4px}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
@media (max-width:760px){.grid2{grid-template-columns:1fr}}
.input{padding:12px;border-radius:10px;border:1px solid var(--line);background:#0e1730;color:#fff;font-weight:900;letter-spacing:.6px}
.btn{display:inline-flex;align-items:center;justify-content:center;padding:12px 14px;border-radius:10px;border:1px solid #2aa7d8;text-transform:uppercase;font-weight:1000;color:#fff;letter-spacing:.6px;box-shadow:0 2px 0 rgba(0,0,0,.25),0 0 0 1px rgba(255,255,255,.06) inset;background:linear-gradient(180deg,var(--blue1),var(--blue2))}
.btn.ghost{background:#0f182b}
.btn.green{background:linear-gradient(180deg,var(--green1),var(--green2));border-color:#14804b}
.btn.red{background:linear-gradient(180deg,var(--red1),var(--red2));border-color:#8b2a2a}
.btn.orange{background:linear-gradient(180deg,var(--amber1),var(--amber2));border-color:#8a5f19}
.row{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center}
.row3{display:grid;grid-template-columns:140px 1fr auto;gap:8px;align-items:center}
.row4{display:grid;grid-template-columns:120px 1fr 1fr auto;gap:8px;align-items:center}
.kv{display:flex;gap:8px;flex-wrap:wrap}
.pill{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border-radius:999px;border:1px solid var(--line);background:#0e1830;font-weight:1000}
.list{margin-top:6px}
.item{display:grid;grid-template-columns:1fr auto;gap:8px;align-items:center;padding:10px;border-radius:10px;background:#0e1930;border:1px solid var(--line);margin-top:8px}
.small{font-size:12px;color:var(--muted);letter-spacing:.4px}
.tbl{width:100%;border-collapse:collapse;margin-top:6px}
.tbl th,.tbl td{border-bottom:1px solid var(--line);padding:8px 6px;text-align:left;font-size:14px}
.tbl th{color:#cfe3ff;font-weight:900}
.right{text-align:right}
.sep{border-top:1px dashed var(--line);margin:10px 0}
.footerNav{position:sticky;bottom:0;background:rgba(10,14,24,.9);backdrop-filter:blur(6px);border-top:1px solid var(--line);padding:10px;margin-top:14px;border-radius:12px 12px 0 0;display:flex;gap:10px;justify-content:space-between}
</style>
</head>
<body>
<div class="app">
  <div class="header">
    <div class="brand">
      <div class="logo">ğŸ’¶</div>
      <div><h1>ARKA</h1><div class="small">Pagesat â€¢ Transport â€¢ Shpenzime</div></div>
    </div>
    <div class="kv">
      <span class="pill" id="dayState">Dita: â€”</span>
      <a class="btn ghost" href="../">ğŸ  HOME</a>
    </div>
  </div>

  <!-- DITA: Hape / Mbylle -->
  <div class="panel">
    <div class="row">
      <div class="kv">
        <button class="btn green" id="btnOpenDay">â‡¢ HAPE DITÃ‹N</button>
        <button class="btn red" id="btnCloseDay">â‡  MBYLLE DITÃ‹N</button>
        <button class="btn ghost" id="btnToday">SOT</button>
      </div>
      <div class="pill" id="todayLabel">â€”</div>
    </div>
    <div class="sep"></div>
    <div class="grid2">
      <div>
        <h2>Transport â€¢ Shto PagesÃ«</h2>
        <div class="row4">
          <input class="input" id="twTcode" placeholder="T5">
          <input class="input" id="twAmount" inputmode="decimal" placeholder="Shuma â‚¬">
          <input class="input" id="twNote" placeholder="ShÃ«nim (opsional)">
          <button class="btn" id="twAdd">+ Regjistro</button>
        </div>
        <div class="list" id="tpayList"></div>
      </div>
      <div>
        <h2>Shpenzime</h2>
        <div class="row4">
          <input class="input" id="exTcode" placeholder="T? (ops.)">
          <input class="input" id="exAmount" inputmode="decimal" placeholder="Shuma â‚¬">
          <input class="input" id="exNote" placeholder="Arsyeja p.sh. karburant">
          <button class="btn orange" id="exAdd">+ Shto</button>
        </div>
        <div class="list" id="exList"></div>
      </div>
    </div>
    <div class="sep"></div>
    <div>
      <h2>ARKA â€¢ PagesÃ« BazÃ« (desk)</h2>
      <div class="row3">
        <input class="input" id="bpAmount" inputmode="decimal" placeholder="Shuma â‚¬">
        <input class="input" id="bpNote" placeholder="p.sh. Paguar nÃ« bazÃ«">
        <button class="btn" id="bpAdd">+ Regjistro</button>
      </div>
      <div class="list" id="bpList"></div>
    </div>
  </div>

  <!-- PÃ‹RMBLEDHJE E DITÃ‹S -->
  <div class="panel" style="margin-top:12px">
    <h2>PÃ«rmbledhje e DitÃ«s</h2>
    <table class="tbl">
      <thead><tr><th>Kategori</th><th class="right">â‚¬</th></tr></thead>
      <tbody id="dayTbl">
        <!-- rows injected -->
      </tbody>
      <tfoot>
        <tr><th>Total Neto</th><th class="right" id="dayNet">0.00</th></tr>
      </tfoot>
    </table>
  </div>

  <!-- JAVA: TRANSPORT -->
  <div class="panel" style="margin-top:12px">
    <div class="row">
      <h2>Transport â€¢ Java</h2>
      <div class="kv">
        <button id="twPrev" class="btn ghost" type="button">â—€</button>
        <div id="twLabel" class="pill">â€”</div>
        <button id="twNext" class="btn ghost" type="button">â–¶</button>
        <button id="twToday2" class="btn ghost" type="button">Sot</button>
      </div>
    </div>
    <table class="tbl" id="twTbl">
      <thead>
        <tr>
          <th>T</th><th>Emri</th><th class="right">mÂ²</th><th class="right">â‚¬ Faturuar</th><th class="right">â‚¬ TÃ« arkÃ«tuara</th><th class="right">â‚¬ Mbetje</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- DETYRIME (All-time) -->
  <div class="panel" style="margin-top:12px">
    <h2>Detyrime nga Transporti (Gjithsej)</h2>
    <table class="tbl" id="debtTbl">
      <thead><tr><th>T</th><th>Emri</th><th class="right">â‚¬ Borxh</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="footerNav">
    <a class="btn ghost" href="../">ğŸ  HOME</a>
    <a class="btn ghost" href="../pastrimi/">ğŸ§¼ PASTRIMI</a>
  </div>
</div>

<script>
// ---------- Shared localStorage structure (compatible with your app) ----------
const LIST_KEY='order_list_v1';
const KEY=id=>`order_${id}`;
function getIndex(){ try{return JSON.parse(localStorage.getItem(LIST_KEY)||'[]')}catch(_){return []} }
function getOrder(id){ try{return JSON.parse(localStorage.getItem(KEY(id))||'null')}catch(_){return null} }

// Extract T code from an order
function tcodeOf(o){
  return String(
    (o?.transport && o.transport.code) ||
    o?.transport_code || o?.tcode ||
    (o?.client && o.client.transportCode) || ''
  ).toUpperCase();
}

// Optional transporter names mapping: localStorage.t_names = {"T1":"Blerim","T2":"Doni"}
function getTNames(){ try{ return JSON.parse(localStorage.getItem('t_names')||'{}'); }catch(_){ return {}; } }

// ---------- Ledgers ----------
const TPAY_KEY='arka_transport_payments_v1'; // {id,ts,tcode,amount,note}
const EX_KEY='arka_expenses_v1';             // {id,ts,tcode?,amount,note}
const BPAY_KEY='arka_base_payments_v1';      // {id,ts,amount,note}

function getArr(k){ try{ return JSON.parse(localStorage.getItem(k)||'[]'); }catch(_){ return []; } }
function setArr(k, arr){ localStorage.setItem(k, JSON.stringify(arr||[])); }

function addTPayment(tcode, amount, note){
  tcode = String(tcode||'').toUpperCase();
  const amt = +Number(amount||0).toFixed(2);
  if(!/^T\d+$/.test(tcode) || !(amt>0)) return {ok:false,msg:'T ose shuma e pavlefshme'};
  const arr = getArr(TPAY_KEY);
  arr.push({id:'tp_'+Date.now(), ts:Date.now(), tcode, amount:amt, note:String(note||'')});
  setArr(TPAY_KEY, arr);
  return {ok:true};
}
function addExpense(tcode, amount, note){
  const hasT = !!String(tcode||'').trim();
  const t = hasT ? String(tcode).toUpperCase() : '';
  const amt = +Number(amount||0).toFixed(2);
  if(!(amt>0)) return {ok:false,msg:'Shuma e shpenzimit Ã«shtÃ« e pavlefshme'};
  if(hasT && !/^T\d+$/.test(t)) return {ok:false,msg:'Kodi T i pavlefshÃ«m'};
  const arr = getArr(EX_KEY);
  arr.push({id:'ex_'+Date.now(), ts:Date.now(), tcode: t || null, amount:amt, note:String(note||'')});
  setArr(EX_KEY, arr);
  return {ok:true};
}
function addBasePayment(amount, note){
  const amt = +Number(amount||0).toFixed(2);
  if(!(amt>0)) return {ok:false,msg:'Shuma e pavlefshme'};
  const arr = getArr(BPAY_KEY);
  arr.push({id:'bp_'+Date.now(), ts:Date.now(), amount:amt, note:String(note||'')});
  setArr(BPAY_KEY, arr);
  return {ok:true};
}

// ---------- Day open/close ----------
const DAY_OPEN_KEY='arka_day_open_v1'; // {date:'YYYY-MM-DD', ts_open}
const DAYS_KEY='arka_days_v1';         // [{date, open_ts, close_ts, sums:{...}, tbreakdown:{T:{collected,expenses}}}]

function todayStr(d=new Date()){ const p=n=>String(n).padStart(2,'0'); return `${d.getFullYear()}-${p(d.getMonth()+1)}-${p(d.getDate())}`; }
function fmt(ts){ const d=new Date(ts); const p=n=>String(n).padStart(2,'0'); return `${p(d.getDate())}.${p(d.getMonth()+1)} ${p(d.getHours())}:${p(d.getMinutes())}`; }

function getOpenDay(){ try{return JSON.parse(localStorage.getItem(DAY_OPEN_KEY)||'null')}catch(_){return null} }
function setOpenDay(obj){ if(obj) localStorage.setItem(DAY_OPEN_KEY, JSON.stringify(obj)); else localStorage.removeItem(DAY_OPEN_KEY); }
function pushClosedDay(rec){ const arr=getArr(DAYS_KEY); arr.unshift(rec); setArr(DAYS_KEY, arr); }

// ---------- Date range helpers ----------
function ts00(d){ return new Date(d.getFullYear(), d.getMonth(), d.getDate()).getTime(); }
function rangeFor(dateStr){ const [y,m,d]=dateStr.split('-').map(x=>parseInt(x,10)); const s=new Date(y,m-1,d); const start=ts00(s); const end=start+24*3600*1000; return {start,end}; }
function inRange(ts,start,end){ const t=Number(ts||0); return t>=start && t<end; }

// ---------- Daily computations ----------
function sumTransportCollected(start,end){
  return getArr(TPAY_KEY).filter(x=>inRange(x.ts,start,end))
    .reduce((s,x)=>s+Number(x.amount||0),0);
}
function sumBaseCollected(start,end){
  return getArr(BPAY_KEY).filter(x=>inRange(x.ts,start,end))
    .reduce((s,x)=>s+Number(x.amount||0),0);
}
function sumExpenses(start,end){
  return getArr(EX_KEY).filter(x=>inRange(x.ts,start,end))
    .reduce((s,x)=>s+Number(x.amount||0),0);
}

// For T breakdown (collected & expenses today)
function tBreakdownToday(start,end){
  const out={};
  for(const p of getArr(TPAY_KEY)){ if(!inRange(p.ts,start,end)) continue; const t=p.tcode; out[t]=out[t]||{collected:0,expenses:0}; out[t].collected += Number(p.amount||0); }
  for(const e of getArr(EX_KEY)){ if(!inRange(e.ts,start,end)) continue; if(!e.tcode) continue; const t=e.tcode; out[t]=out[t]||{collected:0,expenses:0}; out[t].expenses += Number(e.amount||0); }
  for(const k in out){ out[k].collected=+out[k].collected.toFixed(2); out[k].expenses=+out[k].expenses.toFixed(2); }
  return out;
}

// ---------- Weekly aggregates from orders + payments ----------
function weekRange(offsetWeeks=0){
  const now=new Date(); const d=new Date(now.getFullYear(), now.getMonth(), now.getDate());
  const wd=d.getDay(); const deltaToMon = (wd===0 ? -6 : (1-wd));
  const startDate=new Date(d); startDate.setDate(d.getDate()+deltaToMon+offsetWeeks*7);
  const start=ts00(startDate); const end=start+7*24*3600*1000;
  const s=new Date(start), e=new Date(end-1);
  const p=n=>String(n).padStart(2,'0');
  const label=`${p(s.getDate())}.${p(s.getMonth()+1)}.${String(s.getFullYear()).slice(-2)} â€“ ${p(e.getDate())}.${p(e.getMonth()+1)}.${String(e.getFullYear()).slice(-2)}`;
  return {start,end,label};
}
function weeklyBilledByT(start,end){
  const acc={};
  for(const row of getIndex()){
    const o=getOrder(row.id); if(!o) continue;
    if(!inRange(o.ts,start,end)) continue; // this week
    const t=tcodeOf(o); if(!/^T\d+$/.test(t)) continue;
    const m2=Number(o?.pay?.m2||0); const euro=Number(o?.pay?.euro||0);
    if(!acc[t]) acc[t]={m2:0,billed:0};
    acc[t].m2+=m2; acc[t].billed+=euro;
  }
  for(const t in acc){ acc[t].m2=+acc[t].m2.toFixed(2); acc[t].billed=+acc[t].billed.toFixed(2); }
  return acc;
}
function weeklyCollectedByT(start,end){
  const map={};
  for(const p of getArr(TPAY_KEY)){ if(!inRange(p.ts,start,end)) continue; const t=p.tcode; map[t]=(Number(map[t]||0)+Number(p.amount||0)); }
  for(const t in map){ map[t]=+map[t].toFixed(2); }
  return map;
}

// All-time billed vs collected (debts)
function allTimeDebts(){
  const billed={};
  for(const row of getIndex()){
    const o=getOrder(row.id); if(!o) continue;
    const t=tcodeOf(o); if(!/^T\d+$/.test(t)) continue;
    billed[t]=(Number(billed[t]||0)+Number(o?.pay?.euro||0));
  }
  const collected={};
  for(const p of getArr(TPAY_KEY)){ const t=p.tcode; collected[t]=(Number(collected[t]||0)+Number(p.amount||0)); }
  const out=[];
  for(const t in billed){
    const due = +(Number(billed[t]) - Number(collected[t]||0)).toFixed(2);
    if(due>0.005) out.push({t, due});
  }
  // sort desc by due
  out.sort((a,b)=>b.due-a.due);
  return out;
}

// ---------- Rendering ----------
const el = sel=>document.querySelector(sel);

function renderDay(dateStr){
  const {start,end}=rangeFor(dateStr);
  el('#todayLabel').textContent = `${dateStr} â€¢ ${fmt(start)}`;
  // State label
  const opened=getOpenDay();
  if(opened && opened.date===dateStr){
    el('#dayState').textContent = `Dita: Hapur (${dateStr})`;
  }else{
    el('#dayState').textContent = `Dita: Mbyllur (${dateStr})`;
  }

  // Transport payments list (today)
  const tpayDiv=el('#tpayList'); const todayTP=getArr(TPAY_KEY).filter(x=>inRange(x.ts,start,end));
  if(todayTP.length===0) tpayDiv.innerHTML='<div class="small">â€” pa regjistrime sot</div>';
  else tpayDiv.innerHTML = todayTP.map(p=>`
    <div class="item">
      <div><b>${p.tcode}</b> â€¢ â‚¬${p.amount.toFixed(2)} <span class="small">â€¢ ${fmt(p.ts)}</span><br><span class="small">${p.note||''}</span></div>
      <div class="small">id: ${p.id}</div>
    </div>
  `).join('');

  // Expenses (today)
  const exDiv=el('#exList'); const todayEX=getArr(EX_KEY).filter(x=>inRange(x.ts,start,end));
  if(todayEX.length===0) exDiv.innerHTML='<div class="small">â€” pa shpenzime sot</div>';
  else exDiv.innerHTML = todayEX.map(e=>`
    <div class="item">
      <div><b>â‚¬${e.amount.toFixed(2)}</b> ${e.tcode?`â€¢ ${e.tcode}`:''} <span class="small">â€¢ ${fmt(e.ts)}</span><br><span class="small">${e.note||''}</span></div>
      <div class="small">${e.id}</div>
    </div>
  `).join('');

  // Base payments (today)
  const bpDiv=el('#bpList'); const todayBP=getArr(BPAY_KEY).filter(x=>inRange(x.ts,start,end));
  if(todayBP.length===0) bpDiv.innerHTML='<div class="small">â€” pa pagesa nÃ« bazÃ« sot</div>';
  else bpDiv.innerHTML = todayBP.map(p=>`
    <div class="item">
      <div><b>â‚¬${p.amount.toFixed(2)}</b> <span class="small">â€¢ ${fmt(p.ts)}</span><br><span class="small">${p.note||''}</span></div>
      <div class="small">${p.id}</div>
    </div>
  `).join('');

  // Day table
  const tCol = sumTransportCollected(start,end);
  const bCol = sumBaseCollected(start,end);
  const ex   = sumExpenses(start,end);
  const net  = +(tCol + bCol - ex).toFixed(2);

  el('#dayTbl').innerHTML = `
    <tr><td>Transport (tÃ« arkÃ«tuara)</td><td class="right">${tCol.toFixed(2)}</td></tr>
    <tr><td>BazÃ« (tÃ« arkÃ«tuara)</td><td class="right">${bCol.toFixed(2)}</td></tr>
    <tr><td>Shpenzime</td><td class="right">âˆ’ ${ex.toFixed(2)}</td></tr>
  `;
  el('#dayNet').textContent = net.toFixed(2);
}

let weekOffset=0;
function renderWeek(){
  const {start,end,label}=weekRange(weekOffset);
  el('#twLabel').textContent = label;
  const billed=weeklyBilledByT(start,end);
  const collected=weeklyCollectedByT(start,end);
  const tnames=getTNames();
  const tbody=el('#twTbl tbody');
  const rows=[];
  const keys=new Set([...Object.keys(billed), ...Object.keys(collected)]);
  for(const t of [...keys].sort((a,b)=>a.localeCompare(b))){
    const b=billed[t]?.billed||0;
    const m2=billed[t]?.m2||0;
    const c=collected[t]||0;
    const due=+(b-c).toFixed(2);
    rows.push(`<tr>
      <td>${t}</td>
      <td>${tnames[t]||''}</td>
      <td class="right">${m2.toFixed(2)}</td>
      <td class="right">${b.toFixed(2)}</td>
      <td class="right">${c.toFixed(2)}</td>
      <td class="right" style="color:${due>0?'#ff9f9f':'#9fffa2'}">${due.toFixed(2)}</td>
    </tr>`);
  }
  tbody.innerHTML = rows.join('') || `<tr><td colspan="6" class="small">â€” pa tÃ« dhÃ«na pÃ«r kÃ«tÃ« javÃ«</td></tr>`;
}

function renderDebts(){
  const tnames=getTNames();
  const tbody=el('#debtTbl tbody');
  const arr=allTimeDebts();
  tbody.innerHTML = arr.length? arr.map(d=>`
    <tr><td>${d.t}</td><td>${tnames[d.t]||''}</td><td class="right">${d.due.toFixed(2)}</td></tr>
  `).join('') : `<tr><td colspan="3" class="small">â€” pa borxhe</td></tr>`;
}

// ---------- UI wiring ----------
function toast(msg){ alert(msg); }

(function init(){
  const today = todayStr(); renderDay(today); renderWeek(); renderDebts();

  el('#btnToday')?.addEventListener('click', ()=>{ renderDay(todayStr()); });
  el('#btnOpenDay')?.addEventListener('click', ()=>{
    const t=todayStr(); const cur=getOpenDay();
    if(cur && cur.date===t){ toast('Dita tashmÃ« Ã«shtÃ« e hapur.'); return; }
    setOpenDay({date:t, ts_open:Date.now()});
    renderDay(t);
  });
  el('#btnCloseDay')?.addEventListener('click', ()=>{
    const cur=getOpenDay(); if(!cur){ toast('AsnjÃ« ditÃ« e hapur.'); return; }
    const d=cur.date; const {start,end}=rangeFor(d);
    const sums={
      transport: +sumTransportCollected(start,end).toFixed(2),
      base: +sumBaseCollected(start,end).toFixed(2),
      expenses: +sumExpenses(start,end).toFixed(2),
    };
    const tbr=tBreakdownToday(start,end);
    pushClosedDay({date:d, open_ts:cur.ts_open, close_ts:Date.now(), sums, tbreakdown:tbr});
    setOpenDay(null);
    renderDay(todayStr());
    toast('Dita u mbyll.');
  });

  // transport payment add
  el('#twAdd')?.addEventListener('click', ()=>{
    const t=el('#twTcode')?.value||''; const a=el('#twAmount')?.value||''; const n=el('#twNote')?.value||'';
    const r=addTPayment(t,a,n); if(!r.ok){ toast(r.msg); return; }
    el('#twAmount').value=''; el('#twNote').value='';
    renderDay(todayStr()); renderWeek(); renderDebts();
  });
  // expenses add
  el('#exAdd')?.addEventListener('click', ()=>{
    const t=el('#exTcode')?.value||''; const a=el('#exAmount')?.value||''; const n=el('#exNote')?.value||'';
    const r=addExpense(t,a,n); if(!r.ok){ toast(r.msg); return; }
    el('#exAmount').value=''; el('#exNote').value='';
    renderDay(todayStr()); renderWeek(); // debts unchanged
  });
  // base payment add
  el('#bpAdd')?.addEventListener('click', ()=>{
    const a=el('#bpAmount')?.value||''; const n=el('#bpNote')?.value||'';
    const r=addBasePayment(a,n); if(!r.ok){ toast(r.msg); return; }
    el('#bpAmount').value=''; el('#bpNote').value='';
    renderDay(todayStr());
  });

  // week nav
  el('#twPrev')?.addEventListener('click', ()=>{ weekOffset--; renderWeek(); });
  el('#twNext')?.addEventListener('click', ()=>{ weekOffset++; renderWeek(); });
  el('#twToday2')?.addEventListener('click', ()=>{ weekOffset=0; renderWeek(); });
})();
</script>
</body>
</html>